<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏π‡πà</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{font-family:'Kanit',system-ui,sans-serif!important}
body{margin:0;background:#f5f7fb}
.container{max-width:420px;margin:auto;padding:16px}
.tabs{background:#fff;border-radius:14px;display:flex;padding:6px;margin-bottom:16px;position:relative;overflow:hidden}
.tab{z-index:1;flex:1;text-align:center;padding:10px;border-radius:12px;color:#666;font-size:14px;cursor:pointer}
.tab.active{color:#fff;font-weight:600}
h3{margin:10px 0;color:#e53935;font-size:18px;text-align:center}
.card{background:#fff;border-radius:18px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.row{display:flex;gap:8px;margin-bottom:12px}
.col{flex:1}
label{font-size:13px;color:#555}
input,select,textarea{width:100%;padding:10px;margin-top:4px;border-radius:12px;border:1px solid #ddd;font-size:14px;box-sizing:border-box}
input::placeholder, textarea::placeholder{color:#aaa;font-weight:300}
textarea{min-height:80px;resize:none}
.upload{border:2px dashed #e53935;border-radius:16px;padding:18px;text-align:center;margin-top:12px;font-weight:500;cursor:pointer}
.upload.car{border-color:#2196f3;color:#2196f3;background:#e3f2fd}
.upload.bill{border-color:#e53935;color:#e53935;background:#fdecea}
.submit{margin-top:16px;width:100%;background:#2196f3;color:#fff;border:none;border-radius:16px;padding:14px;font-size:16px;font-weight:600;cursor:pointer}
.money-wrapper{position:relative}
.money-wrapper .unit{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#666}
.tab-indicator{position:absolute;top:6px;bottom:6px;left:6px;width:calc(50% - 6px);background:#e53935;border-radius:12px;transition:.25s;z-index:0}
.preview-img{width:100%;margin-top:8px;border-radius:12px}
</style>
</head>
<body>
<div class="container">
<h2 style="text-align:center;margin:6px 0 14px;color:#2196f3"><i class="bi bi-speedometer2"></i> ‡πÄ‡∏Å‡∏°‡∏™‡πå ‡∏Ñ‡∏≠‡∏°‡∏°‡∏≠‡∏ô‡πÄ‡∏£‡∏•</h2>
<div class="tabs">
<div class="tab-indicator" id="tabIndicator"></div>
<div class="tab active" id="tabForm"><i class="bi bi-tools"></i> ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</div>
<div class="tab" id="tabHistory"><i class="bi bi-clock-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
</div>

<div id="formTab">
<h3><i class="bi bi-tools"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h3>
<div class="card">

<label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
<input id="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">

<!-- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 -->
<div class="row">
  <div class="col">
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="date" id="date" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà">
  </div>
  <div class="col">
    <label>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
    <input id="plate" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç 1234">
  </div>
  <div class="col">
    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
    <input id="phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678">
  </div>
</div>

<!-- ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 3 -->
<div class="row">
  <div class="col">
    <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
    <select id="brand"></select>
  </div>
  <div class="col">
    <label>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ</label>
    <select id="model"></select>
  </div>
  <div class="col">
    <label>‡∏õ‡∏µ‡∏£‡∏ñ</label>
    <input id="year" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2022">
  </div>
</div>

<label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°</label>
<textarea id="beforeDetail" placeholder="‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î ‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥"></textarea>

<label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</label>
<textarea id="afterDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö"></textarea>

<label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</label>
<div class="money-wrapper">
<input id="price" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3500"><span class="unit">‡∏ö‡∏≤‡∏ó</span>
</div>

<label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏£‡∏ñ</label>
<div class="upload car" onclick="document.getElementById('carImage').click()">
<i class="bi bi-image"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏£‡∏ñ
<input type="file" id="carImage" hidden accept="image/*">
<img id="carPreview" class="preview-img" />
</div>

<label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏¥‡∏•</label>
<div class="upload bill" onclick="document.getElementById('billImage').click()">
<i class="bi bi-receipt"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ö‡∏¥‡∏•
<input type="file" id="billImage" hidden accept="image/*">
<img id="billPreview" class="preview-img" />
</div>

<button class="submit" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
</div>
</div>

<div id="historyTab" style="display:none">
<h3><i class="bi bi-clock-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h3>
<div id="historyList"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCmj37F4VLFX_SkNWwPFR2xODdU7D77eKg",
authDomain: "garage-system-c15b6.firebaseapp.com",
projectId: "garage-system-c15b6",
storageBucket: "garage-system-c15b6.firebasestorage.app",
messagingSenderId: "1021919346596",
appId: "1:1021919346596:web:ad5915eac27ff5535c8b31"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== ‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏ï‡∏≤‡∏°‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ ===== */
const carData = {
  Toyota:["Revo","Vios","Fortuner","Yaris"],
  Isuzu:["D-Max","MU-X"],
  Honda:["Civic","City","CR-V"],
  Mitsubishi:["Triton","Pajero"],
  Nissan:["Navara","Almera"]
};

const brandSelect = document.getElementById("brand");
const modelSelect = document.getElementById("model");

brandSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</option>';
Object.keys(carData).forEach(b=>{
  brandSelect.innerHTML += `<option value="${b}">${b}</option>`;
});

brandSelect.onchange = ()=>{
  const models = carData[brandSelect.value] || [];
  modelSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô</option>';
  models.forEach(m=>{
    modelSelect.innerHTML += `<option value="${m}">${m}</option>`;
  });
};

/* ===== Firebase Logic ===== */
let editingId=null;
let carBase64="";
let billBase64="";

function readImage(input,previewSetter){
const file=input.files[0];
if(!file) return;
const reader=new FileReader();
reader.onload=e=>previewSetter(e.target.result);
reader.readAsDataURL(file);
}

carImage.onchange=()=>readImage(carImage,(src)=>{carBase64=src;carPreview.src=src;});
billImage.onchange=()=>readImage(billImage,(src)=>{billBase64=src;billPreview.src=src;});

window.saveData=async function(){
const data={
name:name.value,
date:date.value,
plate:plate.value,
phone:phone.value,
brand:brand.value,
model:model.value,
year:year.value,
beforeDetail:beforeDetail.value,
afterDetail:afterDetail.value,
price:price.value,
carImage:carBase64,
billImage:billBase64,
createdAt:new Date()
};

if(editingId){
await updateDoc(doc(db,"jobs",editingId),data);
editingId=null;
}else{
await addDoc(collection(db,"jobs"),data);
}
alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
showTab('history');
}

window.loadHistory=async function(){
const snap=await getDocs(collection(db,"jobs"));
let html="";
snap.forEach(d=>{
const i=d.data();
html+=`<div style='background:#fff;padding:12px;margin-bottom:10px;border-radius:12px;'>
<b>${i.name||'-'}</b><br>
üöó ${i.brand||''} ${i.model||''}<br>
üè∑ ${i.plate||'-'}<br>
üí∞ ${i.price||0} ‡∏ö‡∏≤‡∏ó<br>
<button onclick="editData('${d.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
<button onclick="deleteData('${d.id}')">‡∏•‡∏ö</button>
</div>`;
});
historyList.innerHTML=html||"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
}

window.deleteData=async function(id){
if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?"))return;
await deleteDoc(doc(db,"jobs",id));
loadHistory();
}

window.editData=async function(id){
const snap=await getDoc(doc(db,"jobs",id));
if(!snap.exists())return;
const i=snap.data();
name.value=i.name||"";
date.value=i.date||"";
plate.value=i.plate||"";
phone.value=i.phone||"";
brand.value=i.brand||"";
brandSelect.dispatchEvent(new Event('change'));
model.value=i.model||"";
year.value=i.year||"";
beforeDetail.value=i.beforeDetail||"";
afterDetail.value=i.afterDetail||"";
price.value=i.price||"";
carPreview.src=i.carImage||"";
billPreview.src=i.billImage||"";
carBase64=i.carImage||"";
billBase64=i.billImage||"";
editingId=id;
showTab('form');
}

function showTab(tab){
formTab.style.display=tab==='form'?'block':'none';
historyTab.style.display=tab==='history'?'block':'none';
tabForm.classList.remove('active');
tabHistory.classList.remove('active');
if(tab==='form'){
tabForm.classList.add('active');
tabIndicator.style.transform='translateX(0%)';
}else{
tabHistory.classList.add('active');
tabIndicator.style.transform='translateX(100%)';
loadHistory();
}
}

tabForm.onclick=()=>showTab('form');
tabHistory.onclick=()=>showTab('history');
</script>
</body>
</html>
‚¨á
