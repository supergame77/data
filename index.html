<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏π‡πà</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
*{font-family:'Kanit',system-ui,sans-serif!important}
body{margin:0;background:#f5f7fb}
.container{max-width:420px;margin:auto;padding:16px}
.tabs{background:#fff;border-radius:14px;display:flex;padding:6px;margin-bottom:16px;position:relative;overflow:hidden}
.tab{z-index:1;flex:1;text-align:center;padding:10px;border-radius:12px;color:#666;font-size:14px;cursor:pointer;position:relative}
.tab.active{color:#fff;font-weight:600}
h3{margin:10px 0;color:#e53935;font-size:18px;text-align:center}
.card{background:#fff;border-radius:18px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.row{display:flex;gap:10px;margin-bottom:12px}
.field{flex:1}
label{font-size:13px;color:#555}
input,select,textarea{width:100%;padding:10px;margin-top:4px;border-radius:12px;border:1px solid #ddd;font-size:14px;box-sizing:border-box}
textarea{min-height:70px;resize:none}
.submit{margin-top:16px;width:100%;background:#2196f3;color:#fff;border:none;border-radius:16px;padding:14px;font-size:16px;font-weight:600;cursor:pointer}
.money-wrapper{position:relative}
.money-wrapper .unit{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#666;pointer-events:none}
.tab-indicator{position:absolute;top:6px;bottom:6px;left:6px;width:calc(50% - 6px);background:#e53935;border-radius:12px;transition:.25s;z-index:0}
</style>
</head>
<body>
<div class="container">
<h2 style="text-align:center;margin:6px 0 14px;color:#2196f3"><i class="bi bi-speedometer2"></i> ‡πÄ‡∏Å‡∏°‡∏™‡πå ‡∏Ñ‡∏≠‡∏°‡∏°‡∏≠‡∏ô‡πÄ‡∏£‡∏•</h2>
<div class="tabs">
<div class="tab-indicator" id="tabIndicator"></div>
<div class="tab active" id="tabForm">‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</div>
<div class="tab" id="tabHistory">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
</div>

<div id="formTab">
<h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h3>
<div class="card">
<label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
<input id="name">
<label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
<input type="date" id="date">
<label>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
<input id="plate">
<label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
<input id="phone">
<label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
<input id="brand">
<label>‡∏£‡∏∏‡πà‡∏ô</label>
<input id="model">
<label>‡∏õ‡∏µ</label>
<input id="year">
<label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</label>
<div class="money-wrapper">
<input id="price"><span class="unit">‡∏ö‡∏≤‡∏ó</span>
</div>
<button class="submit" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
</div>
</div>

<div id="historyTab" style="display:none">
<h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
<div id="historyList"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCmj37F4VLFX_SkNWwPFR2xODdU7D77eKg",
  authDomain: "garage-system-c15b6.firebaseapp.com",
  projectId: "garage-system-c15b6",
  storageBucket: "garage-system-c15b6.firebasestorage.app",
  messagingSenderId: "1021919346596",
  appId: "1:1021919346596:web:ad5915eac27ff5535c8b31"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let editingId = null;

window.saveData = async function(){
  const data = {
    name: name.value,
    date: date.value,
    plate: plate.value,
    phone: phone.value,
    brand: brand.value,
    model: model.value,
    year: year.value,
    price: price.value,
    createdAt: new Date()
  };

  if(editingId){
    await updateDoc(doc(db,"jobs",editingId), data);
    editingId=null;
  }else{
    await addDoc(collection(db,"jobs"), data);
  }

  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  loadHistory();
  showTab('history');
}

window.loadHistory = async function(){
  const snap = await getDocs(collection(db,"jobs"));
  let html="";
  snap.forEach(d=>{
    const item=d.data();
    html+=`<div style='background:#fff;padding:12px;margin-bottom:10px;border-radius:12px;'>
      <b>${item.name||'-'}</b><br>
      üìÖ ${item.date||'-'}<br>
      üöó ${item.brand||''} ${item.model||''}<br>
      üè∑ ${item.plate||'-'}<br>
      üí∞ ${item.price||0} ‡∏ö‡∏≤‡∏ó<br>
      <button onclick="editData('${d.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      <button onclick="deleteData('${d.id}')">‡∏•‡∏ö</button>
    </div>`;
  });
  historyList.innerHTML=html||"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
}

window.deleteData = async function(id){
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?"))return;
  await deleteDoc(doc(db,"jobs",id));
  loadHistory();
}

window.editData = async function(id){
  const snap = await getDocs(collection(db,"jobs"));
  snap.forEach(d=>{
    if(d.id===id){
      const i=d.data();
      name.value=i.name;
      date.value=i.date;
      plate.value=i.plate;
      phone.value=i.phone;
      brand.value=i.brand;
      model.value=i.model;
      year.value=i.year;
      price.value=i.price;
      editingId=id;
      showTab('form');
    }
  });
}

function showTab(tab){
  formTab.style.display=tab==='form'?'block':'none';
  historyTab.style.display=tab==='history'?'block':'none';
  tabForm.classList.remove('active');
  tabHistory.classList.remove('active');
  if(tab==='form'){
    tabForm.classList.add('active');
    tabIndicator.style.transform='translateX(0%)';
  }else{
    tabHistory.classList.add('active');
    tabIndicator.style.transform='translateX(100%)';
    loadHistory();
  }
}

tabForm.onclick=()=>showTab('form');
tabHistory.onclick=()=>showTab('history');

</script>
</body>
</html>
